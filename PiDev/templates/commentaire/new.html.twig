{% extends 'base3.html.twig' %}
{% block body %}

{#  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"> #}

<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700&display=swap" rel="stylesheet">

        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">



<link rel="stylesheet" href="../../css/css/styles.css">
<link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">
    <script src="https://use.fontawesome.com/your-embed-code.js"></script> <!-- TODO: Place your Font Awesome embed code  -->


<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css" rel="stylesheet">



<div class="hero-wrap js-fullheight" style="background-image: url('../../images/bg_2.jpg'); height: 754px;">
        <div class="overlay"></div>
        <div class="container">
            <div class="row no-gutters slider-text js-fullheight align-items-center justify-content-center" data-scrollax-parent="true" style="height: 754px;">
                <div class="col-md-9 ftco-animate text-center fadeInUp ftco-animated" data-scrollax=" properties: { translateY: '70%' }" style="transform: translateZ(0px) translateY(0%);">
                    <p class="breadcrumbs" data-scrollax="properties: { translateY: '30%', opacity: 1.6 }" style="opacity: 1; transform: translateZ(0px) translateY(0%);"><span class="mr-2"><a href="index.html">Home</a></span> <span>Tour</span></p>
                    <h1 class="mb-3 bread" data-scrollax="properties: { translateY: '30%', opacity: 1.6 }" style="opacity: 1; transform: translateZ(0px) translateY(0%);">Votre compte</h1>
                </div>
            </div>
        </div>
    </div>

<div class="container">

    <div class="be-comment-block">
       <button onclick="ff()"></button>

        <h1 class="comments-title"> </h1>

        {% for commentaire in commentaires %}



            {% if commentaire.parent==null %}




            <h2>Commentaire {{ loop.index }}</h2>



            <div class="be-comment">
                <div class="be-img-comment">
                    <a href="blog-detail-2.html">
                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="be-ava-comment">
                    </a>
                </div>


				<span class="be-comment-name">
                    <div type="hidden">

                    </div>
					 {{ commentaire.idclient.prenom }} 	 {{ commentaire.idclient.nom }}

					</span>
                    <span class="be-comment-time">
					<i class="fa fa-clock-o"></i>
					{{ commentaire.datePost|date('d-m-Y h:m:s') }}
				</span>
                    <p class="be-comment-text">{{commentaire.contenu }} </p>

                    {#  si id clé etrangere mtaa client heya nafsha mtaa id eli amalt bih login#}

                    {% if app.user.id == commentaire.idclient.id  %}
                    <a href="{{ path('app_commentaire_edit', {'idcomm': commentaire.idcomm}) }}">edit</a>

                    {% endif %}

                    {#
                   {{ app.user.id }}
                    {{ commentaire.idclient.id}} #}
<p><a href="#ajout-commentaire" data-reply data-id="{{ commentaire.idComm }}" class=" btn btn-primary press  ">Reply</a></p>
   <div id="parent">



    <a href="{{ path('commentaire_like',{'comm':commentaire.idComm}) }}"  onclick="showData(Math.round(Math.random() * 10),event);ff();" class="btn btn-link js-like">

    {% if app.user and commentaire.isLikedByUser(app.user) %}

					<i class="fa fa-thumbs-up"> </i>


{% else %}
                					<i class="fa fa-thumbs-o-up"> </i>

{% endif %}
                            <span class="js-likes">{{ commentaire.likes|length }}</span>
                            <span class="js-label">J'aime</span>


                        </a>



                     {# //////////////partie dislike///////// #}
                     <a href="{{ path('commentaire_dislike',{'comm':commentaire.idComm}) }}"  onclick="showDatadislikes(Math.round(Math.random() * 10),event)" class="btn btn-link js-dislike">

    {% if app.user and commentaire.isDislikedByUser(app.user) %}

					<i class="fa fa-thumbs-down"> </i>


{% else %}
                					<i class="fa fa-thumbs-o-down"> </i>

{% endif %}
                            <span class="js-dislikes">{{ commentaire.dislikes|length }}</span>
                            <span class="js-label">J'aime pas</span>


                        </a>

                     {# //////////////////////// #}
    {% endif %}
{# on affiche les reponses #}
    {% for reply in commentaire.replies %}
     <div class="be-comment">
                <div class="be-img-comment">
                    <a href="blog-detail-2.html">
                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="be-ava-comment">
                    </a>
                </div>
                <div class="be-comment-content">

				<span class="be-comment-name">
                    <div type="hidden">


                    </div>

					 {{ reply.idclient.prenom }} 	 {{ reply.idclient.nom }}

					</span>
                    <span class="be-comment-time">
					<i class="fa fa-clock-o"></i>
					{{ reply.datePost|date('d-m-Y h:m:s') }}
				</span>
                    <p class="be-comment-text">{{reply.contenu }} </p>


                    {#  si id clé etrangere mtaa client heya nafsha mtaa id eli amalt bih login#}

                    {% if app.user.id == reply.idclient.id  %}

                    <a href="{{ path('app_commentaire_edit', {'idcomm': reply.idcomm}) }}">edit</a>
                    {% endif %}

                    {#
                   {{ app.user.id }}
                    {{ commentaire.idclient.id}} #}
     <div>

<p><a href="#ajout-commentaire" data-reply data-id="{{ commentaire.idComm }}" class=" btn btn-primary press  ">Reply</a></p>





    {% endfor %}


     </div>






            </div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

        {% endfor %}

        <form class="form-block">
            <div class="row">

                <div class="col-xs-12 col-sm-6 fl_icon">
                    <div class="form-group fl_icon">

                    </div>
                </div>


            </div>

        </form>





        <h1  class="comments-title">Ajouter un commentaire</h1>

            <div class="be-comment">
                <div class="be-img-comment">
                    <a href="blog-detail-2.html">
                        <img src="https://bootdey.com/img/Content/avatar/avatar1.png" alt="" class="be-ava-comment">
                    </a>
                </div>
                <div  id="ajout-commentaire" class="be-comment-content">

				<span class="be-comment-name">

					</span>
                    <span class="be-comment-time">
					<i class="fa fa-clock-o"></i>
					May 27, 2015 at 3:14am

				</span>

                    {{ form_start(form) }}
                 {#  {{ app.session.get('id') }}
                    {{ app.session.get('prenom') }}#}

                    {{ form_widget(form.contenu,{'attr':{'class':'form-control' ,'placeholder':'Type your comment here'}}) }}







                </div>


            </div>


        <form class="form-block">
            <div class="row">

                <div class="col-xs-12 col-sm-6 fl_icon">


                        <button class="form-control btn btn-primary submit px-3">{{ button_label|default('add') }}</button>

                        {{ form_end(form) }}

                </div>


            </div>


        </form>




{% endblock %}
{% block javascripts %}
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

    <script>
        window.onload =()=>
        {
            //ecouteur d event sur tous les boutons reply
            document.querySelectorAll("[data-reply]").forEach(element=>
            {
                element.addEventListener("click",function ()
                {
                   // console.log(this);
                    document.querySelector( "#commentaire1_parentid").value=this.dataset.id;
                });
            });
        }
    </script>

<script>

function onClickBtnLike(event)
{
    event.preventDefault();
            const url=this.href;
            const spanCount=this.querySelector('span.js-likes');
        const icone=this.querySelector('i');

    axios.get(url).then(function (response)
    {


        const likes=response.data.likes;
        spanCount.textContent=likes;
        if(icone.classList.contains('fa-thumbs-up')) icone.classList.replace('fa-thumbs-up','fa-thumbs-o-up')
       else icone.classList.replace('fa-thumbs-o-up','fa-thumbs-up');
        console.log(response );
    })
}
    function showData(randomNumber,event)
    {
            event.preventDefault();


    document.querySelectorAll('a.js-like').forEach(function (link)
    {
    link.addEventListener('click',onClickBtnLike);



    })
    }

    {# fonction dislike #}
     function showDatadislikes(randomNumber,event)
    {
            event.preventDefault();


    document.querySelectorAll('a.js-dislike').forEach(function (link)
    {
    link.addEventListener('click',onClickBtnDislike);



    })
    }

    {# fction click btn dislike #}
    function onClickBtnDislike(event)
{
    event.preventDefault();
            const url=this.href;
            const spanCount=this.querySelector('span.js-dislikes');
        const icone=this.querySelector('i');

    axios.get(url).then(function (response)
    {


        const dislikes=response.data.dislikes;
        spanCount.textContent=dislikes;
        if(icone.classList.contains('fa-thumbs-down')) icone.classList.replace('fa-thumbs-down','fa-thumbs-o-down')
       else icone.classList.replace('fa-thumbs-o-down','fa-thumbs-down');
        console.log(response );
    })
}

    </script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/mustache.js/0.8.1/mustache.js"></script>

    <script type="text/javascript" src="https//ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js">
    <script type="text/javascript" src="../../public/js/mustache.js">


</script>
        <script type="text/javascript">

  function ff()
{
        (function ($)
        {
            $.fn.notif=function (options)
            {
                var options= $.extend(
                    {
                    html: '<div class="notification" style="background-color: beige; z-index:2000; box-shadow:0px 4px 30px rgba(0,0,0,0.5); ">\
       <div class="right">\
       <h2>jaime ajouté par: {{ commentaire.idclient.nom   }} {{ commentaire.idclient.prenom }} sur un commentaire </h2> \
       <p></p>\
       </div>\
       </div> '
                    },options)

                    return this.each(function ()
                    {
                       var $this= $(this);
                       var $notifs=$('> .notifications',this);
                       var $notif=$(Mustache.render(options.html,options));
                       if($notifs.length ==0)
                           {
                               $notifs= $ ('<div class="notifications "/>');
                               $this.append($notifs);
                           }
                       $notifs.append($notif);
                       $notif.click(function (event)
                       {
                           event.preventDefault();
                           $notif.slideUp();
                       })
                    })
                console.log(options);
            }

            $('body').notif({title:'mon tite',content:'Mon contenu'})
        })(jQuery);
        }
            </script>

{% endblock %}